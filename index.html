<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Restaurant Log</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root {
  --bg: #f2f2f7;
  --card: #ffffff;
  --text: #1c1c1e;
  --accent: #ff6b4a;
  --muted: #8e8e93;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: #000000;
    --card: #1c1c1e;
    --text: #ffffff;
    --accent: #ff7b5c;
    --muted: #8e8e93;
  }
}

body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, system-ui;
  background: var(--bg);
  color: var(--text);
  padding: 20px;
}

h1 {
  text-align: center;
  font-weight: 700;
}

.card {
  background: var(--card);
  padding: 20px;
  border-radius: 18px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
}

input, textarea, select {
  width: 100%;
  padding: 14px;
  border-radius: 14px;
  border: none;
  margin-top: 8px;
  margin-bottom: 16px;
  font-size: 16px;
  background: #f2f2f7;
}

button {
  width: 100%;
  padding: 16px;
  border-radius: 16px;
  border: none;
  font-size: 17px;
  font-weight: 600;
  background: var(--accent);
  color: white;
}

.star {
  font-size: 28px;
  cursor: pointer;
}

.photo-preview {
  width: 100%;
  border-radius: 14px;
  margin-bottom: 10px;
}
</style>
</head>
<body>

<h1>Restaurant Log</h1>

<div class="card">

<label>Date & Time</label>
<input type="datetime-local" id="visit_time" />

<label>Restaurant Name</label>
<input type="text" id="restaurant_name" />

<label>Location</label>
<input type="text" id="address_text" />

<label>Website</label>
<input type="text" id="website_url" />

<label>Specials / Happy Hour</label>
<textarea id="specials"></textarea>

<label>How many people?</label>
<select id="guest_count">
<option>1</option><option>2</option><option>3</option>
<option>4</option><option>5</option><option>6+</option>
</select>

<label>Rating</label>
<div id="stars">
<span class="star">â˜†</span>
<span class="star">â˜†</span>
<span class="star">â˜†</span>
<span class="star">â˜†</span>
<span class="star">â˜†</span>
</div>

<label>Upload Menu Photo</label>
<input type="file" id="photo" accept="image/*" capture="environment" />
<img id="preview" class="photo-preview" />

<button onclick="saveVisit()">Save Visit</button>

</div>

<script>
// ðŸ”´ REPLACE THESE TWO VALUES
const SUPABASE_URL = "https://yvgtxvipbbxbbfezpcfe.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_aAU6721_Vv_s46eLjiGJlQ_4G5GKrQZ";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let rating = 0;
document.querySelectorAll('.star').forEach((star, index) => {
  star.addEventListener('click', () => {
    rating = index + 1;
    document.querySelectorAll('.star').forEach((s,i)=>{
      s.textContent = i < rating ? "â­" : "â˜†";
    });
  });
});

document.getElementById('photo').addEventListener('change', function(e){
  const reader = new FileReader();
  reader.onload = function(){
    document.getElementById('preview').src = reader.result;
  }
  reader.readAsDataURL(e.target.files[0]);
});

async function saveVisit() {

  const file = document.getElementById("photo").files[0];
  let photo_url = null;

  if (file) {
    const fileName = Date.now() + "-" + file.name;
    const { data, error } = await supabase.storage
      .from('restaurant-photos')
      .upload(fileName, file);

    if (!error) {
      photo_url = SUPABASE_URL + "/storage/v1/object/public/restaurant-photos/" + fileName;
    }
  }

  const { error } = await supabase.from('restaurant_visits').insert([{
    visit_time: document.getElementById("visit_time").value,
    restaurant_name: document.getElementById("restaurant_name").value,
    address_text: document.getElementById("address_text").value,
    website_url: document.getElementById("website_url").value,
    specials: document.getElementById("specials").value,
    guest_count: document.getElementById("guest_count").value,
    rating: rating,
    photo_url: photo_url
  }]);

  if (!error) {
    alert("Saved!");
    document.querySelector("form")?.reset();
  } else {
    alert("Error saving visit");
  }
}
</script>

</body>
</html>
