<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restaurant Log</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
 --bg:#f5f2ee;
 --card:#ffffff;
 --text:#1d1d1f;
 --accent:#b08968;
 --muted:#6e6e73;
}
@media(prefers-color-scheme:dark){
 :root{
  --bg:#121212;
  --card:#1e1e1e;
  --text:#ffffff;
  --accent:#d4a373;
  --muted:#a1a1a6;
 }
}
body{
 margin:0;
 font-family:-apple-system, BlinkMacSystemFont, system-ui;
 background:var(--bg);
 color:var(--text);
 padding:20px;
}
h1{
 text-align:center;
 font-weight:600;
}
.card{
 background:var(--card);
 padding:20px;
 border-radius:20px;
 box-shadow:0 8px 24px rgba(0,0,0,0.08);
 margin-bottom:20px;
}
input,textarea,select{
 width:100%;
 padding:14px;
 margin-top:8px;
 margin-bottom:16px;
 border-radius:14px;
 border:1px solid #ddd;
 font-size:16px;
}
button{
 width:100%;
 padding:16px;
 border:none;
 border-radius:16px;
 font-weight:600;
 font-size:16px;
 background:var(--accent);
 color:white;
}
.star{
 font-size:28px;
 cursor:pointer;
}
.menu-category{
 margin-top:20px;
 padding-top:10px;
 border-top:1px solid #eee;
}
.menu-item{
 margin-bottom:10px;
 padding:10px;
 background:#f2f2f7;
 border-radius:12px;
}
</style>
</head>
<body>

<h1>Restaurant Log</h1>

<div class="card">

<label>Date & Time</label>
<input type="datetime-local" id="visit_time">

<label>Restaurant Name</label>
<input type="text" id="restaurant_name">

<label>Address</label>
<input type="text" id="address_text">

<label>Website</label>
<input type="text" id="website_url">

<label>Specials</label>
<textarea id="specials"></textarea>

<label>Guests</label>
<select id="guest_count">
<option>1</option><option>2</option><option>3</option>
<option>4</option><option>5</option><option>6</option>
<option>7</option><option>8</option><option>9</option>
<option>10</option>
</select>

<label>Rating</label>
<div id="stars"></div>

<div id="menuSection"></div>

<button onclick="saveVisit()">Save Visit</button>

</div>

<script>
const SUPABASE_URL = "https://yvgtxvipbbxbbfezpcfe.supabase.co";
const SUPABASE_ANON_KEY = "sb_publishable_aAU6721_Vv_s46eLjiGJlQ_4G5GKrQZ";

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let rating = 0;
const starContainer = document.getElementById("stars");
for(let i=1;i<=5;i++){
 let s=document.createElement("span");
 s.innerHTML="☆";
 s.className="star";
 s.onclick=()=>{
  rating=i;
  document.querySelectorAll(".star").forEach((el,idx)=>{
   el.innerHTML=idx<i?"⭐":"☆";
  });
 };
 starContainer.appendChild(s);
}

document.getElementById("visit_time").value =
 new Date().toISOString().slice(0,16);

const categories = [
 "Appetizers","Soup / Salad","Side Orders",
 "Lunch","Dinner","Dessert","Beverages"
];

const menuSection = document.getElementById("menuSection");

categories.forEach(cat=>{
 let wrapper=document.createElement("div");
 wrapper.className="menu-category";
 wrapper.innerHTML=`<strong>${cat}</strong>
 <button type="button" onclick="addItem('${cat}')">+ Add Item</button>
 <div id="items-${cat}"></div>`;
 menuSection.appendChild(wrapper);
});

function addItem(category){
 const container=document.getElementById("items-"+category);
 const div=document.createElement("div");
 div.className="menu-item";
 div.innerHTML=`
  <input placeholder="Item name" class="item-name">
  <input placeholder="Price (optional)" class="item-price">
  <input placeholder="Notes" class="item-notes">
 `;
 container.appendChild(div);
}

async function saveVisit(){

 const { data:visit, error:visitError } =
 await supabase.from("restaurant_visits")
 .insert([{
  visit_time:document.getElementById("visit_time").value,
  restaurant_name:document.getElementById("restaurant_name").value,
  address_text:document.getElementById("address_text").value,
  website_url:document.getElementById("website_url").value,
  specials:document.getElementById("specials").value,
  guest_count:document.getElementById("guest_count").value,
  rating:rating
 }]).select();

 if(visitError){
  alert("Visit save failed");
  return;
 }

 const visitId = visit[0].id;

 for(const cat of categories){
  const container=document.getElementById("items-"+cat);
  const items=container.querySelectorAll(".menu-item");
  for(const item of items){
   const name=item.querySelector(".item-name").value;
   if(!name) continue;
   await supabase.from("visit_menu_items").insert([{
    visit_id:visitId,
    category:cat,
    item_name:name,
    price:item.querySelector(".item-price").value,
    notes:item.querySelector(".item-notes").value
   }]);
  }
 }

 alert("Saved successfully");
 location.reload();
}
</script>

</body>
</html>
